
<!-- edudap-office/app/templates/attendance.html -->
{% extends "base.html" %}
{% block title %}Attendance Â· EDUDAP CRM{% endblock %}
{% block content %}
<div class="container py-4">
  <h1 class="h4 mb-3">Attendance</h1>
  <p class="text-muted">Use the buttons below to record your attendance.</p>

  <div class="d-flex gap-2 mb-3">
    <button id="btnPunchIn" class="btn btn-success"><i class="bi bi-box-arrow-in-right"></i> Punch In</button>
    <button id="btnPunchOut" class="btn btn-danger"><i class="bi bi-box-arrow-left"></i> Punch Out</button>
  </div>

  <div id="result" class="alert d-none" role="alert"></div>
</div>

<script>
(function () {
  const punch = async (status) => {
    try {
      const form = new URLSearchParams();
      form.append('status', status);

      const r = await fetch('{{ url_for("portal.attendance_punch") }}', {
        method: 'POST',
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
        body: form.toString()
      });
      const data = await r.json();
      const $result = document.getElementById('result');

      if (r.ok && data && data.ok) {
        $result.className = 'alert alert-success';
        $result.textContent = `Success: ${data.status} at ${data.timestamp}`;
      } else {
        $result.className = 'alert alert-warning';
        $result.textContent = 'Request completed but server did not return ok=true.';
      }
      $result.classList.remove('d-none');
    } catch (err) {
      const $result = document.getElementById('result');
      $result.className = 'alert alert-danger';
      $result.textContent = 'Error sending attendance. Please try again.';
      $result.classList.remove('d-none');
    }
  };
  document.getElementById('btnPunchIn')?.addEventListener('click', () => punch('in'));
  document.getElementById('btnPunchOut')?.addEventListener('click', () => punch('out'));
})();
</script>
{% endblock %}
