
{% extends 'base.html' %}
{% block content %}
<h2>Dashboard</h2>
<ul class="nav nav-tabs" id="searchTab" role="tablist">
  <li class="nav-item" role="presentation">
    <button class="nav-link active" id="tab-search" data-bs-toggle="tab" data-bs-target="#pane-search" type="button" role="tab">Search</button>
  </li>
  <li class="nav-item" role="presentation">
    <button class="nav-link" id="tab-upload" data-bs-toggle="tab" data-bs-target="#pane-upload" type="button" role="tab">Upload</button>
  </li>
</ul>
<div class="tab-content pt-3">
  <div class="tab-pane fade show active" id="pane-search" role="tabpanel">
    <div class="mb-3">
      <input id="smart-search" class="form-control form-control-lg" placeholder="Type product name, make, brand, or catalog number..." />
    </div>
    <ul id="search-results" class="list-group"></ul>
  </div>
  <div class="tab-pane fade" id="pane-upload" role="tabpanel">
    <form method="post" action="{{ url_for('portal.upload_file') }}" enctype="multipart/form-data">
      <div class="mb-3">
        <label class="form-label">Upload CSV / XLSX / PDF</label>
        <input class="form-control" type="file" name="file" accept=".csv,.xlsx,.xls,.pdf" required />
      </div>
      <button class="btn btn-primary" type="submit">Upload & Index</button>
    </form>
  </div>
</div>
<script>
const input = document.getElementById('smart-search');
const list = document.getElementById('search-results');
let t;
input.addEventListener('input', () => {
  clearTimeout(t);
  const q = input.value.trim();
  t = setTimeout(async () => {
    if (q.length < 2) { list.innerHTML = ''; return; }
    const r = await fetch(`{{ url_for('portal.api_search') }}?q=` + encodeURIComponent(q));
    const data = await r.json();
    list.innerHTML = '';
    data.results.forEach(x => {
      const li = document.createElement('li');
      li.className = 'list-group-item';
      li.innerHTML = `<strong>${x.item_description||''}</strong><br><small>${x.make||''} ${x.brand||''} ${x.cat_no||''} ${x.rate||''}</small>`;
      list.appendChild(li);
    });
  }, 250);
});
</script>
{% endblock %}
